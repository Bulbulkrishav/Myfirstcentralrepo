pipeline {
    agent any
    parameters {
        // string(name: 'Greeting', defaultValue: 'Hello', description: 'How should I greet the world?')
            choice(
                choices: ['CREATE', 'DELETE']
                )  }
    stages {
        stage('Checkout') {
            steps {
                deleteDir()
                checkout scm
            }
        }
        stage('build') {
            steps {
                withAWS(credentials: 'aws-cli-auth-cred', region: 'us-east-1') {
                sh '''
                echo "hello world"
                ls -ltr
                '''
                }
            }
        }
        stage('deploy') {
            steps {
                script {
                    if (env.parameters == 'CREATE') 
                        {
                        sh '''
                        echo "stack creation"
                        ls -ltr
                        aws cloudformation create-stack --stack-name EC2-CFT-1 --template-body file://EC2-single.yml --parameters ParameterKey=KeyName,ParameterValue=linuxpractice
                        '''
                        }
                    if (env.BRANCH_NAME == 'DELETE') 
                        {
                        sh '''
                        echo "stack deletion"
                        aws cloudformation delete-stack --stack-name EC2-CFT-1 
                        '''
                        }
                    else {
                        sh "echo 'welcome!'"
                        }
                    }
            }
        }
    }
    post {
        failure {
            mail to: bulbulshiv04@gmail.com, subject: 'The Pipeline failed :('
            }
        }
}