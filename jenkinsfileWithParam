pipeline {
    agent any
    parameters {
        // string(name: 'Greeting', defaultValue: 'Hello', description: 'How should I greet the world?')
        choice(name: 'METHOD', choices: ['create','delete'], description: 'select create or delete stack')
        string(name: 'STACK_PREFIX', defaultValue: '', description: 'enter your stack prefix') 
        }
    stages {
        stage('Checkout') {
            steps {
                deleteDir()
                checkout scm
            }
        }
        stage('deploy') {
            steps {
                script {

                    withAWS(credentials: 'aws-cli-auth-cred', region: 'us-east-1'){

                        if ( params.METHOD == 'create' && params.STACK_PREFIX != "" ) 
                            
                            {
                            sh '''
                            echo "stack creation"
                            ls -ltr
                            aws cloudformation create-stack --stack-name EC2-CFT-1 --template-body file://EC2-single.yml --parameters ParameterKey=KeyName,ParameterValue=linuxpractice
                            '''
                            }
                        else if ( params.METHOD == 'delete') 
                            {
                            sh '''
                            echo "stack deletion"
                            aws cloudformation delete-stack --stack-name EC2-CFT-1 
                            '''
                            }
                    }
                }    
            }
        }
    }
}